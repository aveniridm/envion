<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Envion v3 — Guida completa</title>
<style>
  :root{
    --bg:#0b0d10; --fg:#e7ecf1; --muted:#9fb1c3; --accent:#7bdba6; --accent2:#88b4ff; --warn:#ffd166; --danger:#ff6b6b;
    --card:#12151a; --card2:#0f1317; --code:#0b1116; --border:#1f2630; --note:#1a212b;
  }
  html,body{height:100%; background:var(--bg); color:var(--fg); font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"}
  main{max-width:1024px; margin:40px auto; padding:0 20px 80px}
  h1,h2,h3{line-height:1.2; letter-spacing:.2px}
  h1{font-size:clamp(28px,4vw,44px); margin:0 0 6px}
  h2{font-size:clamp(22px,3vw,28px); margin:34px 0 12px}
  h3{font-size:20px; margin:24px 0 8px}
  p{margin:10px 0}
  .sub{color:var(--muted)}
  .grid{display:grid; gap:16px}
  @media(min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}
  .card{background:linear-gradient(180deg,var(--card),var(--card2)); border:1px solid var(--border); border-radius:18px; padding:18px 18px}
  .kicker{display:inline-block; padding:3px 10px; border-radius:999px; background:#10161f; border:1px solid var(--border); color:var(--accent2); font-weight:600; letter-spacing:.3px}
  .tag{display:inline-block; padding:2px 8px; border-radius:999px; background:#0e171f; border:1px solid var(--border); color:var(--muted); font-size:12px}
  .box{border:1px solid var(--border); border-left:3px solid var(--accent); padding:14px 14px; border-radius:14px; background:var(--note); margin:12px 0}
  .box.warn{border-left-color:var(--warn)}
  .box.danger{border-left-color:var(--danger)}
  .novita{background:linear-gradient(180deg,#0e151b,#0f1720); border:1px solid #1b2330; border-left:3px solid var(--accent2); padding:14px; border-radius:14px}
  code, pre{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
  pre{background:var(--code); border:1px solid var(--border); border-radius:14px; padding:14px; overflow:auto}
  kbd{font:12px ui-monospace, Menlo, Consolas; padding:2px 6px; border-radius:6px; background:#0f1822; border:1px solid var(--border); color:#cee1f4}
  .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border:1px dashed var(--border); border-radius:12px}
  .lead{font-size:18px; color:#cfe6ff}
  .toc a{color:var(--muted); text-decoration:none}
  .toc a:hover{color:var(--fg); text-decoration:underline}
  .kbdrow{display:flex; gap:8px; flex-wrap:wrap}
  .muted{color:var(--muted)}
  hr{border:none; border-top:1px solid var(--border); margin:26px 0}
  .list{margin:0; padding-left:18px}
  .checklist{list-style:"✔  "; padding-left:22px}
  .caption{font-size:13px; color:var(--muted)}
</style>
</head>
<body>
<main>
  <div class="pill" style="margin-bottom:14px">
    <span class="kicker">Envion v3</span>
    <span class="tag">Algorithmic Envelope Dynatext Sequencer</span>
    <span class="tag">Pure Data</span>
    <span class="tag">v3.0 (set 2025)</span>
  </div>
  <h1>Guida completa a <em>Envion</em> v3</h1>
  <p class="sub">Documento tecnico e operativo per musicisti acusmatici / concreti, sound‑designer e ricercatori.</p>

  <div class="novita">
    <h2>TL;DR — Novità principali della v3 (vs v1)</h2>
    <ul class="checklist">
      <li><strong>Duplicazione mono→stereo immediata</strong> con <code>[array copy]</code> (interno a Pd): copia rapida <code>samplebufL → samplebufR</code> quando carichi file mono.</li>
      <li><strong>Routing migliorato</strong>: più <code>[send]/[receive]</code>, nuove <code>[outlet~]</code> per l'uso di Envion come <em>abstraction</em> dentro patch più grandi.</li>
      <li><strong>Player stereo dedicato</strong>: doppio <code>[tabread4~]</code> (L/R) e <code>[snake~ out]</code> per instradamenti multicanale.</li>
      <li><strong>Selettore &amp; Randomizzatore di inviluppi</strong> da <code>[text get]</code> con slider e pulsanti (dynatext): scegli un indice o pesca un inviluppo a caso da librerie molto estese (≈10k pattern).</li>
      <li><strong>UI annotata</strong> con elementi di <code>ELSE/[note]</code> (“AUDIO”, “INVILUPPO”, “AUDIO RECORDER”, “END”, “min”, “sec”) che rendono il flusso chiaro e performabile.</li>
      <li><strong>Conteggio parallelo</strong> (countdown listener) e strumenti per il calcolo della <em>durata totale</em> (offset + durata) dei segmenti.</li>
    </ul>
    <p class="caption">Differenze rilevate confrontando i file: <code>___ Envion_v3.0.pd</code> e <code>___ Envion_v1.0.pd</code>. V3 introduce <code>[array copy]</code>, più <code>[vline~]</code> (3 istanze), più <code>[r]/[s]</code>, <code>[outlet~]</code>, e un secondo <code>[snake~ out]</code>.</p>
  </div>

  <h2>Cos'è Envion (in breve)</h2>
  <p class="lead">Envion non è un semplice <em>sampler</em> e non è un <em>granularizzatore</em> tradizionale. È un <strong>motore envelope‑first</strong>: un lettore di buffer stereo la cui traiettoria temporale è diretta da <code>[vline~]</code> attraverso liste di <em>terne</em> (valore, tempo, ritardo) caricate da lunghi file di testo.</p>
  <div class="box">
    <p>Ne risulta un comportamento <strong>organico</strong>, micro‑gestuale e altamente articolabile: perfetto per musica <strong>acusmatica / concreta</strong>, sound art, design di gesto e sintassi non metriche.
    </p>
  </div>

  <h2>Perché è diverso da un sampler o da un granular</h2>
  <ul class="list">
    <li><strong>Sampler</strong>: riproduce un file con start/end/transpose. Envion invece <em>scrive</em> la traiettoria del lettore tramite inviluppi arbitrari a terne e la può cambiare a ogni colpo.</li>
    <li><strong>Granular</strong>: crea molti grani regolari/pseudo‑casuali. Envion produce <em>macro‑grani deterministici</em> (o scelti da libreria) il cui profilo è descritto in terne, con <em>ritardi per‑segmento</em> che abilitano pattern irregolari e “respiri” organici.</li>
    <li><strong>Dynatext</strong>: usa file testuali molto lunghi (≈10k inviluppi) come <em>repertorio</em> sostituibile al volo. È un approccio più vicino a una <em>partitura algoritmica</em> che a un player di campioni.</li>
  </ul>

  <h2>Architettura (alto livello)</h2>
  <div class="card">
  <pre><code>Audio (stereo):  samplebufL/R  &lt;-- [soundfiler] &lt;-- [openpanel]
Index driver:    [vline~] &lt;-- &lt;liste di terne&gt; da [text define] / [text get]
Player:          [tabread4~ samplebufL]  +  [tabread4~ samplebufR]
Routing:         [snake~ out] → [pp.out~] (o direttamente [dac~])
Utility:         conteggio durata, countdown parallelo, recorder, mono→stereo
  </code></pre>
  <p class="caption">Dal patch v3 si rilevano: <code>[soundfiler]</code>, <code>[text define -k lista-sample]</code>, <code>[text get lista-sample]</code>, doppio <code>[tabread4~]</code>, <code>[vline~]</code>, <code>[snake~ out]</code>, <code>[pp.out~]</code>, <code>[array copy]</code>, annotazioni <code>ELSE/[note]</code>.</p>
  </div>

  <h2>Le “terne” degli inviluppi</h2>
  <p>Ogni segmento è una terna <code>&lt;valore&gt; &lt;tempo_ms&gt; &lt;ritardo_ms&gt;</code>. Concatenando più terne si ottiene una traiettoria complessa per <code>[vline~]</code>. Esempio (4 terne):</p>
  <pre><code>1 0 0   0.58 19 0   0.28 22 19   0 25 41</code></pre>
  <p>Nel patch trovi anche preset/esempi formattati come <code>set $1 $2 ... $12</code> per aggiornare rapidamente dodici campi (4 terne).</p>
  <div class="box warn">
    <strong>Nota Pd:</strong> nelle <em>message box</em> i separatori di terne multiple richiedono la virgola <code>,</code>. In Pd testuale la virgola è scritta come <code>\,</code>; se componi messaggi via <code>set</code> usa <code>addcomma</code> per inserirla correttamente.
  </div>

  <h2>Librerie di inviluppi (≈10k pattern)</h2>
  <p>Envion legge file di testo con molte righe, ciascuna una lista di terne. In v3 trovi una pipeline completa:</p>
  <ul class="list">
    <li><code>[text define -k lista-sample]</code> per mantenere in RAM la libreria di inviluppi.</li>
    <li><code>[openpanel]</code> → <code>[list prepend read]</code> → <code>[list trim]</code> → <code>[text define]</code> per caricare file molto lunghi.</li>
    <li><code>[text get lista-sample]</code> per estrarre una riga a indice (slider “select-env-from-text-get-list”) o casualmente.</li>
    <li>Etichette funzionali visive: “<em>percussive</em>”, “<em>hybrid</em>”, “<em>invalid</em>” per classificare e testare rapidamente famiglie di inviluppi.</li>
  </ul>
  <div class="box">
    <strong>Preset inclusi:</strong> il patch contiene esempi percussivi a zero attacco, ibridi (attacchi dolci) e inviluppi “di prova”. Usa questi come punto di partenza per creare i tuoi set da studio/concerto.
  </div>

  <h2>Caricamento audio</h2>
  <ol class="list">
    <li>Premi <kbd>Open</kbd> → <code>[openpanel]</code>.</li>
    <li>Il file viene caricato con <code>[soundfiler]</code> in <code>samplebufL</code> e <code>samplebufR</code>:<br>
      <pre><code>read -resize $1 samplebufL samplebufR</code></pre>
    </li>
    <li><strong>Mono → Stereo:</strong> se il tuo Pd non duplica il canale mono automaticamente, usa in v3:<br>
      <pre><code>[array copy]
; array.copy samplebufR samplebufL</code></pre>
      che copia il contenuto di L in R.</li>
  </ol>
  <div class="box warn">
    <strong>Velocità “originale” (dall'inizio alla fine).</strong><br>
    La logica v3 prepara il messaggio per <code>[vline~]</code> come:
    <pre><code>set 0, addcomma, add $ARRAY_SIZE $DURATA_MS</code></pre>
    Invia poi: <code>0, &lt;array_size&gt; &lt;durata_ms&gt;</code>. Esempio per 88200 campioni in 2000 ms:<br>
    <code>0, 88200 2000</code> → indice lineare a velocità 44.1 kHz ≈ reale.</div>

  <h2>Playback con ritardi “inusuali”</h2>
  <p>Ogni terna ha un <em>ritardo</em> interno che permette di:
  </p>
  <ul class="list">
    <li>inserire <strong>spostamenti micro‑temporali</strong> per battere “respiri” tra segmenti;</li>
    <li>comporre <strong>pattern irregolari</strong> senza usare <code>[metro]</code> espliciti;</li>
    <li>allineare o disallineare l'indice tra L e R per micro‑stereo instabile.</li>
  </ul>
  <div class="box">
    <strong>Durata totale</strong>: la v3 espone oggetti/utility (commentati nel patch) per calcolare <em>offset finale + durata finale</em> in ms. È utile per sincronizzare altri processi o per pilotare un counter “END”.</div>

  <h2>Uscite &amp; Recorder</h2>
  <p>Il segnale stereo passa da <code>[snake~ out]</code> al blocco di uscita. Nel patch c'è un modulo <code>pp.out~</code> (uscita/monitor). Se non disponibile nel tuo sistema, puoi sostituirlo con un semplice <code>[dac~]</code> o il tuo bus di out preferito.</p>
  <p>Annotazioni “AUDIO RECORDER” indicano la presenza di un registratore integrato: registra l'output di Envion direttamente dalla patch per creare studi, take, o layering.</p>

  <h2>Controlli &amp; Interazione</h2>
  <ul class="list">
    <li><strong>Trigger da tastiera</strong> via <code>[key]</code> e pulsanti <code>[bng]</code> (es. “tasto 1 key innesco”).</li>
    <li><strong>Slider indice</strong> per scegliere l'inviluppo da <code>[text get]</code>.</li>
    <li><strong>Box lista</strong> che mostrano la riga estratta (comoda per il debug).</li>
    <li><strong>Scope</strong> (<code>[scope~]</code>) per controllo visivo dell'ampiezza.</li>
  </ul>

  <h2>Dipendenze &amp; Requisiti</h2>
  <div class="grid grid-2">
    <div class="card">
      <h3>Pure Data</h3>
      <ul class="list">
        <li><strong>Pd Vanilla</strong> consigliato ≥ 0.53 (v3 usa ampiamente <code>[text define/get]</code>). Per <code>[array copy]</code> è consigliata una versione recente (se non la trovi, aggiorna).</li>
        <li>Oggetti Vanilla usati: <code>soundfiler, tabread4~, vline~, expr, line, list, pack, unpack, sel, key, spigot, pow~, random, array.copy</code>.</li>
      </ul>
    </div>
    <div class="card">
      <h3>ELSE (esterni)</h3>
      <ul class="list">
        <li><code>[note]</code> (etichette UI), <code>[snake~]</code> (routing multicanale), <code>[scope~]</code>, <code>[comment]</code>.</li>
        <li>Installa tramite “Find Externals (Deken)” cercando <em>ELSE</em> (Alexandre Porres).</li>
      </ul>
      <p class="caption">Se <code>[pp.out~]</code> non è presente sul tuo sistema, è probabilmente un'astrazione locale: sostituiscila con <code>[dac~]</code> o un blocco out a tua scelta.</p>
    </div>
  </div>

  <h2>Come preparare librerie di inviluppi</h2>
  <ol class="list">
    <li>Crea un file <code>.txt</code> con una riga per inviluppo. Ogni riga = N× terne. Esempio (4 terne):
      <pre><code>1 0 0  0.58 19 0  0.28 22 19  0 25 41</code></pre>
    </li>
    <li>Carica il file: <code>Open → read</code> nella sezione “lista-sample”.</li>
    <li>Seleziona un indice con lo slider o premi il pulsante per random.</li>
    <li>La riga viene inviata a <code>[vline~]</code> per articolare il lettore.</li>
  </ol>

  <h2>Esempi d'uso (acusmatica/concreta)</h2>
  <ul class="list">
    <li><strong>Micro‑gesti granulati</strong>: usa inviluppi brevissimi per “sfogliare” il buffer a colpi (drum‑like) non metrici.</li>
    <li><strong>Traiettorie lunghe</strong>: inviluppi di molti secondi per scritture lente del materiale (ideale per field recording e nastri processati).</li>
    <li><strong>Stagger stereo</strong>: invia L e R con lo stesso inviluppo ma aggiungi ritardi leggermente diversi per micro‑instabilità spaziale.</li>
    <li><strong>Biblioteca performativa</strong>: cambia libreria di inviluppi live aprendo un nuovo file testuale; Envion reagisce istantaneamente.</li>
  </ul>

  <h2>Confronto v1 → v3 (dettaglio tecnico)</h2>
  <div class="card">
    <ul class="list">
      <li><strong>Nuovi oggetti</strong> in v3: <code>[array copy]</code>, <code>[line]</code>, <code>[outlet~]</code> aggiunti; più istanze di <code>[vline~]</code> e <code>[tabread4~]</code>.</li>
      <li><strong>ELSE annotazioni</strong>: <code>[else/note]</code> passa da 3 a 7 istanze, migliorando la leggibilità e la performabilità del patch.</li>
      <li><strong>Routing</strong>: <code>[snake~ out]</code> raddoppia (1→2); più <code>[r]/[s]</code> per integrazione modulare con il resto del tuo ecosistema Pd.</li>
      <li><strong>Utility durata</strong>: blocchi dedicati a “total_duration” e “countdown START (parallel listener)”.</li>
      <li><strong>Player stereo</strong>: doppio <code>[tabread4~ samplebufL/samplebufR]</code> per lettura L/R dedicata.</li>
    </ul>
  </div>

  <h2>Debug &amp; Trucchi</h2>
  <div class="box">
    <ul class="list">
      <li><strong>Virgole nei messaggi</strong>: in Pd le virgole separano messaggi; dentro un <code>[message]</code> usa <code>addcomma</code> o la sequenza <code>\,</code>.</li>
      <li><strong>Array size</strong>: quando suoni “a velocità originale”, usa la dimensione reale dell'array (non il numero di campioni caricati in precedenza).</li>
      <li><strong>Mono→Stereo</strong>: se <code>[array copy]</code> non esiste nella tua versione, duplica via DSP (es. copia L→R con un semplice <code>[*~ 1]</code> o ricarica il file in due array identici).</li>
      <li><strong>pp.out~ mancante</strong>: sostituisci con <code>[dac~]</code> finché non recuperi l'astrazione.</li>
    </ul>
  </div>

  <h2>Riferimento rapido</h2>
  <div class="grid grid-2">
    <div class="card">
      <h3>Messaggi chiave</h3>
      <pre><code>// Carica audio
read -resize $1 samplebufL samplebufR

// Duplicazione L→R (mono → stereo)
; array.copy samplebufR samplebufL

// Gioca l'intero buffer a velocità "originale"
set 0, addcomma, add $ARRAY_SIZE $DURATA_MS
0, 88200 2000

// Imposta 4 terne per vline~
set $1 $2 $3 $4 $5 $6 $7 $8 $9 $10 $11 $12</code></pre>
    </div>
    <div class="card">
      <h3>Oggetti principali</h3>
      <pre><code>Vanilla:  soundfiler, tabread4~, vline~, expr, line,
          list, pack, unpack, sel, key, spigot, pow~, array copy
ELSE:     note, snake~, scope~, comment
Altro:    pp.out~ (astrazione di uscita)</code></pre>
    </div>
  </div>

  <hr>
  <p class="muted">Analisi condotta direttamente sui file <code>___ Envion_v3.0.pd</code> (169 oggetti) e <code>___ Envion_v1.0.pd</code> (120 oggetti). Questa guida riflette la struttura effettiva del patch, ottimizzata per un uso in contesti acusmatici/concreti e performance elettroacustiche.</p>
</main>
</body>
</html>
